<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Test - Check Images Field</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        pre { background: white; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Database Test - Check Images Field</h1>
    
    <div>
        <label for="supabaseUrl">Supabase URL:</label>
        <input type="text" id="supabaseUrl" placeholder="https://your-project.supabase.co" style="width: 400px;">
    </div>
    <div style="margin: 10px 0;">
        <label for="supabaseKey">Supabase Anon Key:</label>
        <input type="text" id="supabaseKey" placeholder="your-anon-key" style="width: 400px;">
    </div>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="checkTournaments()">Check Tournaments</button>
    <button onclick="checkSchema()">Check Schema</button>
    
    <div id="results"></div>

    <script>
        let supabase = null;

        async function testConnection() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                showResult('Please enter both URL and key', 'error');
                return;
            }

            try {
                supabase = window.supabase.createClient(url, key);
                
                // Test connection
                const { data, error } = await supabase.from('tournaments').select('count').limit(1);
                
                if (error) {
                    showResult('Connection failed: ' + error.message, 'error');
                } else {
                    showResult('Connection successful!', 'success');
                }
            } catch (err) {
                showResult('Connection error: ' + err.message, 'error');
            }
        }

        async function checkTournaments() {
            if (!supabase) {
                showResult('Please test connection first', 'error');
                return;
            }

            try {
                // Get all tournaments
                const { data: allTournaments, error: allError } = await supabase
                    .from('tournaments')
                    .select('*')
                    .limit(5);

                if (allError) {
                    showResult('Error fetching tournaments: ' + allError.message, 'error');
                    return;
                }

                showResult(`Found ${allTournaments.length} tournaments:`, 'success');
                
                allTournaments.forEach((tournament, index) => {
                    const hasImages = tournament.images && Array.isArray(tournament.images) && tournament.images.length > 0;
                    showResult(`Tournament ${index + 1}: ${tournament.name} - Images: ${hasImages ? 'Yes (' + tournament.images.length + ')' : 'No'}`, 
                              hasImages ? 'success' : 'error');
                    
                    if (tournament.images) {
                        showResult(`  Images field type: ${typeof tournament.images}`, 'success');
                        showResult(`  Images field value: ${JSON.stringify(tournament.images)}`, 'success');
                    }
                });

                // Check specific tournament with images
                const { data: imageTournaments, error: imageError } = await supabase
                    .from('tournaments')
                    .select('id, name, images')
                    .not('images', 'is', null);

                if (imageError) {
                    showResult('Error checking tournaments with images: ' + imageError.message, 'error');
                } else {
                    showResult(`Found ${imageTournaments.length} tournaments with images field not null:`, 'success');
                    imageTournaments.forEach(t => {
                        showResult(`  ${t.name}: ${JSON.stringify(t.images)}`, 'success');
                    });
                }

            } catch (err) {
                showResult('Error: ' + err.message, 'error');
            }
        }

        async function checkSchema() {
            if (!supabase) {
                showResult('Please test connection first', 'error');
                return;
            }

            try {
                // Check table structure
                const { data: columns, error: columnsError } = await supabase
                    .rpc('get_table_columns', { table_name: 'tournaments' });

                if (columnsError) {
                    // Fallback: try to get schema info
                    const { data: info, error: infoError } = await supabase
                        .from('information_schema.columns')
                        .select('column_name, data_type, is_nullable, column_default')
                        .eq('table_name', 'tournaments')
                        .eq('table_schema', 'public');

                    if (infoError) {
                        showResult('Error getting schema info: ' + infoError.message, 'error');
                        return;
                    }

                    showResult('Tournaments table schema:', 'success');
                    info.forEach(col => {
                        showResult(`  ${col.column_name}: ${col.data_type} (nullable: ${col.is_nullable}, default: ${col.column_default || 'none'})`, 'success');
                    });
                } else {
                    showResult('Tournaments table columns:', 'success');
                    columns.forEach(col => {
                        showResult(`  ${col.column_name}: ${col.data_type}`, 'success');
                    });
                }

            } catch (err) {
                showResult('Error checking schema: ' + err.message, 'error');
            }
        }

        function showResult(message, type = 'result') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
        }
    </script>
</body>
</html>


